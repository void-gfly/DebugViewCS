<ResourceDictionary
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">

    <!--
        全局暗色主题 — 自定义现代配色方案
        ====================================
        灵感来源: VS Code Dark+, JetBrains Fleet, GitHub Dark
        
        色彩体系:
          背景层级:  #FF0D1117 (最深) → #FF161B22 (面板) → #FF1C2128 (控件) → #FF21262D (悬停)→ #FF30363D (边框/分割线)
          文字层级:  #FFF0F6FC (主) → #FF8B949E (次) → #FF484F58 (禁)
          强调色:    #FF58A6FF (蓝) 选中 / #FF388BFD 焦点
          语义色:    #FF3FB950 (绿/成功) #FFD29922 (黄/警告) #FFF85149 (红/错误)
    -->

    <!-- ====================================================================
         第一层: 覆盖 WPF SystemColors — 从根源接管所有标准控件内部配色
         ==================================================================== -->

    <!-- 窗口/面板/弹出框背景 -->
    <SolidColorBrush x:Key="{x:Static SystemColors.WindowBrushKey}"          Color="#FF161B22" />
    <SolidColorBrush x:Key="{x:Static SystemColors.WindowTextBrushKey}"      Color="#FFF0F6FC" />

    <!-- 控件背景 (ComboBox 弹出面板、Tab 未选中、ScrollBar 轨道等) -->
    <SolidColorBrush x:Key="{x:Static SystemColors.ControlBrushKey}"         Color="#FF1C2128" />
    <SolidColorBrush x:Key="{x:Static SystemColors.ControlTextBrushKey}"     Color="#FFF0F6FC" />
    <SolidColorBrush x:Key="{x:Static SystemColors.ControlDarkBrushKey}"     Color="#FF30363D" />
    <SolidColorBrush x:Key="{x:Static SystemColors.ControlLightBrushKey}"    Color="#FF21262D" />
    <SolidColorBrush x:Key="{x:Static SystemColors.ControlDarkDarkBrushKey}" Color="#FF0D1117" />
    <SolidColorBrush x:Key="{x:Static SystemColors.ControlLightLightBrushKey}" Color="#FF30363D" />

    <!-- 选中高亮 -->
    <SolidColorBrush x:Key="{x:Static SystemColors.HighlightBrushKey}"       Color="#FF264F78" />
    <SolidColorBrush x:Key="{x:Static SystemColors.HighlightTextBrushKey}"   Color="#FFF0F6FC" />
    <SolidColorBrush x:Key="{x:Static SystemColors.InactiveSelectionHighlightBrushKey}"     Color="#FF21262D" />
    <SolidColorBrush x:Key="{x:Static SystemColors.InactiveSelectionHighlightTextBrushKey}" Color="#FF8B949E" />

    <!-- 菜单 / 下拉 -->
    <SolidColorBrush x:Key="{x:Static SystemColors.MenuBrushKey}"            Color="#FF161B22" />
    <SolidColorBrush x:Key="{x:Static SystemColors.MenuTextBrushKey}"        Color="#FFF0F6FC" />
    <SolidColorBrush x:Key="{x:Static SystemColors.MenuBarBrushKey}"         Color="#FF161B22" />
    <SolidColorBrush x:Key="{x:Static SystemColors.MenuHighlightBrushKey}"   Color="#FF21262D" />

    <!-- 禁用状态 -->
    <SolidColorBrush x:Key="{x:Static SystemColors.GrayTextBrushKey}"        Color="#FF484F58" />

    <!-- ToolTip -->
    <SolidColorBrush x:Key="{x:Static SystemColors.InfoBrushKey}"            Color="#FF1C2128" />
    <SolidColorBrush x:Key="{x:Static SystemColors.InfoTextBrushKey}"        Color="#FFF0F6FC" />

    <!-- 边框 -->
    <SolidColorBrush x:Key="{x:Static SystemColors.ActiveBorderBrushKey}"    Color="#FF30363D" />
    <SolidColorBrush x:Key="{x:Static SystemColors.InactiveBorderBrushKey}"  Color="#FF21262D" />

    <!-- 桌面/滚动条背景 -->
    <SolidColorBrush x:Key="{x:Static SystemColors.DesktopBrushKey}"         Color="#FF0D1117" />
    <SolidColorBrush x:Key="{x:Static SystemColors.ScrollBarBrushKey}"       Color="#FF161B22" />

    <!-- 按钮 -->
    <SolidColorBrush x:Key="{x:Static SystemColors.ActiveCaptionBrushKey}"   Color="#FF161B22" />
    <SolidColorBrush x:Key="{x:Static SystemColors.ActiveCaptionTextBrushKey}" Color="#FFF0F6FC" />
    <SolidColorBrush x:Key="{x:Static SystemColors.InactiveCaptionBrushKey}" Color="#FF0D1117" />
    <SolidColorBrush x:Key="{x:Static SystemColors.InactiveCaptionTextBrushKey}" Color="#FF8B949E" />

    <!-- ====================================================================
         第二层: 需要自定义 Template 的控件（系统画刷无法覆盖 Template 布局）
         ==================================================================== -->

    <!-- ==================== GridViewColumnHeader ==================== -->
    <Style TargetType="GridViewColumnHeader">
        <Setter Property="Background" Value="#FF161B22" />
        <Setter Property="Foreground" Value="#FF8B949E" />
        <Setter Property="BorderBrush" Value="#FF30363D" />
        <Setter Property="BorderThickness" Value="0,0,1,1" />
        <Setter Property="Padding" Value="8,6" />
        <Setter Property="HorizontalContentAlignment" Value="Left" />
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="GridViewColumnHeader">
                    <Grid>
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" VerticalAlignment="Center" />
                        </Border>
                        <Thumb x:Name="PART_HeaderGripper" HorizontalAlignment="Right" Width="4" Background="Transparent" Margin="0,0,-2,0" />
                    </Grid>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- ==================== ListView ==================== -->
    <Style TargetType="ListView">
        <Setter Property="Background" Value="Transparent" />
        <Setter Property="Foreground" Value="#FFF0F6FC" />
        <Setter Property="BorderBrush" Value="#FF30363D" />
        <Setter Property="BorderThickness" Value="0" />
    </Style>

    <!-- ==================== ListViewItem ==================== -->
    <Style TargetType="ListViewItem">
        <Setter Property="Background" Value="Transparent" />
        <Setter Property="Foreground" Value="#FFF0F6FC" />
        <Setter Property="BorderThickness" Value="0" />
        <Setter Property="Padding" Value="0" />
        <Setter Property="Margin" Value="0" />
        <Setter Property="HorizontalContentAlignment" Value="Stretch" />
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="ListViewItem">
                    <Border x:Name="RootBorder"
                            Background="{TemplateBinding Background}"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="{TemplateBinding BorderThickness}"
                            TextElement.Foreground="{TemplateBinding Foreground}">
                        <Grid>
                            <Border x:Name="HoverBorder" Background="Transparent" />
                            <Border x:Name="SelectedBorder" Background="Transparent" />
                            <GridViewRowPresenter Content="{TemplateBinding Content}" Columns="{TemplateBinding GridView.ColumnCollection}" />
                        </Grid>
                    </Border>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter TargetName="HoverBorder" Property="Background" Value="#15FFFFFF" />
                        </Trigger>
                        <Trigger Property="IsSelected" Value="True">
                            <Setter TargetName="SelectedBorder" Property="Background" Value="#FF264F78" />
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- ==================== TabControl ==================== -->
    <Style TargetType="TabControl">
        <Setter Property="Background" Value="Transparent" />
        <Setter Property="BorderThickness" Value="0" />
        <Setter Property="Foreground" Value="#FFF0F6FC" />
    </Style>

    <!-- ==================== TabItem ==================== -->
    <Style TargetType="TabItem">
        <Setter Property="Foreground" Value="#FF8B949E" />
        <Setter Property="Background" Value="Transparent" />
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="TabItem">
                    <Border x:Name="TabBorder" Padding="14,7" Margin="0,0,2,0" CornerRadius="6,6,0,0"
                            Background="Transparent" BorderThickness="0">
                        <ContentPresenter x:Name="ContentSite" ContentSource="Header" VerticalAlignment="Center" HorizontalAlignment="Center" />
                    </Border>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsSelected" Value="True">
                            <Setter TargetName="TabBorder" Property="Background" Value="#FF1C2128" />
                            <Setter Property="Foreground" Value="#FFF0F6FC" />
                        </Trigger>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter TargetName="TabBorder" Property="Background" Value="#0DFFFFFF" />
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- ==================== TextBox ==================== -->
    <Style TargetType="TextBox">
        <Setter Property="Background" Value="#FF0D1117" />
        <Setter Property="Foreground" Value="#FFF0F6FC" />
        <Setter Property="CaretBrush" Value="#FF58A6FF" />
        <Setter Property="BorderBrush" Value="#FF30363D" />
        <Setter Property="BorderThickness" Value="1" />
        <Setter Property="Padding" Value="6,4" />
        <Setter Property="SelectionBrush" Value="#FF264F78" />
    </Style>

    <!-- ==================== ComboBox 完整模板重写 ==================== -->
    <!-- Aero2 主题的 ComboBox 内部 Popup 背景硬编码白色，
         仅靠 SystemColors 无法覆盖，必须完整重写 ControlTemplate -->

    <!-- ComboBox 内部 ToggleButton -->
    <Style x:Key="DarkComboBoxToggleButton" TargetType="ToggleButton">
        <Setter Property="OverridesDefaultStyle" Value="True"/>
        <Setter Property="IsTabStop" Value="False"/>
        <Setter Property="Focusable" Value="False"/>
        <Setter Property="ClickMode" Value="Press"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="ToggleButton">
                    <Border x:Name="Bd" Background="#FF1C2128" BorderBrush="#FF30363D" BorderThickness="1" CornerRadius="4">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="28"/>
                            </Grid.ColumnDefinitions>
                            <!-- 下拉箭头 -->
                            <Path Grid.Column="1" Data="M0,0 L4,4 L8,0" Stroke="#FF8B949E" StrokeThickness="1.5"
                                  HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Grid>
                    </Border>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter TargetName="Bd" Property="BorderBrush" Value="#FF58A6FF"/>
                        </Trigger>
                        <Trigger Property="IsChecked" Value="True">
                            <Setter TargetName="Bd" Property="BorderBrush" Value="#FF388BFD"/>
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <Style TargetType="ComboBox">
        <Setter Property="Foreground" Value="#FFF0F6FC" />
        <Setter Property="Background" Value="#FF1C2128" />
        <Setter Property="BorderBrush" Value="#FF30363D" />
        <Setter Property="BorderThickness" Value="1"/>
        <Setter Property="Padding" Value="6,4"/>
        <Setter Property="MinHeight" Value="28"/>
        <Setter Property="ScrollViewer.HorizontalScrollBarVisibility" Value="Auto"/>
        <Setter Property="ScrollViewer.VerticalScrollBarVisibility" Value="Auto"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="ComboBox">
                    <Grid>
                        <!-- 下拉按钮 (覆盖整个控件) -->
                        <ToggleButton x:Name="ToggleButton"
                                      Style="{StaticResource DarkComboBoxToggleButton}"
                                      IsChecked="{Binding IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}" />

                        <!-- 显示选中项文本 -->
                        <ContentPresenter x:Name="ContentSite"
                                          IsHitTestVisible="False"
                                          Content="{TemplateBinding SelectionBoxItem}"
                                          ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}"
                                          ContentStringFormat="{TemplateBinding SelectionBoxItemStringFormat}"
                                          Margin="8,0,28,0"
                                          VerticalAlignment="Center"
                                          HorizontalAlignment="Left"/>

                        <!-- 可编辑模式的 TextBox (通常不使用) -->
                        <TextBox x:Name="PART_EditableTextBox"
                                 Visibility="Hidden"
                                 IsReadOnly="{TemplateBinding IsReadOnly}"
                                 Background="Transparent"
                                 Foreground="#FFF0F6FC"
                                 CaretBrush="#FF58A6FF"
                                 Margin="8,0,28,0"
                                 VerticalAlignment="Center"
                                 HorizontalAlignment="Left"
                                 Focusable="True"/>

                        <!-- 下拉弹出框 — 关键: 背景色在此处硬性指定为暗色 -->
                        <Popup x:Name="PART_Popup"
                               Placement="Bottom"
                               IsOpen="{TemplateBinding IsDropDownOpen}"
                               AllowsTransparency="True"
                               Focusable="False"
                               PopupAnimation="Slide">
                            <Grid x:Name="DropDown"
                                  MinWidth="{TemplateBinding ActualWidth}"
                                  MaxHeight="{TemplateBinding MaxDropDownHeight}"
                                  SnapsToDevicePixels="True">
                                <Border x:Name="DropDownBorder"
                                        Background="#FF161B22"
                                        BorderBrush="#FF30363D"
                                        BorderThickness="1"
                                        CornerRadius="4"
                                        Margin="0,2,0,0"
                                        Padding="0,4">
                                    <ScrollViewer SnapsToDevicePixels="True">
                                        <StackPanel IsItemsHost="True" KeyboardNavigation.DirectionalNavigation="Contained"/>
                                    </ScrollViewer>
                                </Border>
                            </Grid>
                        </Popup>
                    </Grid>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsEditable" Value="True">
                            <Setter TargetName="PART_EditableTextBox" Property="Visibility" Value="Visible"/>
                            <Setter TargetName="ContentSite" Property="Visibility" Value="Hidden"/>
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- ==================== ComboBoxItem ==================== -->
    <Style TargetType="ComboBoxItem">
        <Setter Property="Foreground" Value="#FFF0F6FC" />
        <Setter Property="Background" Value="Transparent" />
        <Setter Property="Padding" Value="8,5"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="ComboBoxItem">
                    <Border x:Name="Bd" Background="{TemplateBinding Background}" Padding="{TemplateBinding Padding}">
                        <ContentPresenter VerticalAlignment="Center"/>
                    </Border>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsHighlighted" Value="True">
                            <Setter TargetName="Bd" Property="Background" Value="#FF21262D" />
                        </Trigger>
                        <Trigger Property="IsSelected" Value="True">
                            <Setter TargetName="Bd" Property="Background" Value="#FF264F78" />
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- ==================== Separator (菜单/列表分割线) ==================== -->
    <Style TargetType="Separator">
        <Setter Property="Background" Value="#FF30363D" />
        <Setter Property="BorderBrush" Value="#FF30363D" />
    </Style>

    <!-- ==================== GridSplitter ==================== -->
    <Style TargetType="GridSplitter">
        <Setter Property="Background" Value="#FF30363D" />
    </Style>

</ResourceDictionary>
